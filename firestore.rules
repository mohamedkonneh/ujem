rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    match /testimonials/{testimonial} {
      // Allow anyone to read testimonials
      allow read: if true;

      // Allow creation only if the data is valid
      allow create: if isValidTestimonial();

      // Prevent updates or deletions by public users (requires Admin SDK or Auth to override)
      allow update, delete: if false;
    }

    function isValidTestimonial() {
      let data = request.resource.data;
      
      return data.keys().hasAll(['name', 'role', 'quote', 'image']) &&
             // Validate Name (Bilingual Map)
             data.name is map && data.name.keys().hasAll(['en', 'ar']) &&
             data.name.en is string && data.name.en.size() > 0 && data.name.en.size() < 100 &&
             // Validate Role (Bilingual Map)
             data.role is map && data.role.keys().hasAll(['en', 'ar']) &&
             data.role.en is string && data.role.en.size() < 100 &&
             // Validate Quote (Bilingual Map)
             data.quote is map && data.quote.keys().hasAll(['en', 'ar']) &&
             data.quote.en is string && data.quote.en.size() < 1000 &&
             // Validate Image
             data.image is string;
    }
  }
}